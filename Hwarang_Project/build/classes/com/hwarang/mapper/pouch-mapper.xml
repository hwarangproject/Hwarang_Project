<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hwarang.mapper.pouch-mapper">
	<!--///////////////////////////////////////// 파우치 리스트 -->
	<select id="pouchListData" resultType="PouchVO" parameterType="java.util.Map">
		SELECT pouch_img,member_no,pouch_no,pouch_name,num FROM (SELECT
		pouch_img,member_no,pouch_no,pouch_name,rownum as num
		FROM (SELECT
		pouch_img,member_no,pouch_no,pouch_name FROM pouch ORDER BY pouch_no
		DESC))
		WHERE num BETWEEN #{start} AND #{end}
	</select>
	<!-- 총페이지 -->
	<select id="pouchTotalPage" resultType="int">
		SELECT CEIL(COUNT(*)/6.0) FROM pouch
	</select>

	<!--////////////////////////////////////////// 파우치 디테일 -->
	<select id="pouchDetailData" resultType="PouchVO" parameterType="int">
		SELECT a. pouch_img,a.member_no,a.pouch_no,a.pouch_name,a.pouch_score,a.pouch_like,a.regdate,a.pouch_content, b.skin_type, b.id, b.nickname, b.profile_img
		FROM pouch a ,member b
		WHERE a.member_no = b.member_no
		AND a.pouch_no = #{pouch_no}
	</select>
	
	<select id="memberData" resultType="MemberVO"  parameterType="int">
		SELECT * FROM member WHERE member_no=#{mno}
	</select>
	
	<!-- ////////////////////////////////////////// 파우치 검색 -->
	<select id="pouchFindCount" resultType="int" parameterType="java.util.Map">
		SELECT COUNT(a.pouch_no) 
		FROM pouch a LEFT JOIN member b ON a.member_no=b.member_no 
		WHERE upper(${fs}) LIKE '%'||upper(#{ss})||'%'		
	</select>
	<select id="pouchFindData" resultType="PouchVO" parameterType="java.util.Map">
	 	SELECT a.pouch_no,a.pouch_name,a.regdate,a.pouch_content,a.pouch_like,a.pouch_img,b.nickname 
	 	FROM pouch a,member b 
	 	WHERE a.member_no = b.member_no
	 	AND upper(${fs}) LIKE '%'||upper(#{ss})||'%'
	</select>
	
	<!-- /////////////////////////////////////파우치 댓글 -->
	<select id="pouchReplyListData" resultType="Pouch_ReplyVO" parameterType="int">
     SELECT a.*, b.profile_img, b.id, b.sex, b.skin_type, b.age_group  
     FROM pouch_reply a, member b
     WHERE a.member_no = b.member_no
     AND pouch_no = #{pouch_no}
     ORDER BY a.regdate 
    </select>
    
	<insert id="pouchReplyInsert" parameterType="Pouch_ReplyVO">
     INSERT INTO pouch_reply VALUES(
       #{pouch_reply_no},
       #{pouch_no},
       #{content},
       SYSDATE,
       #{member_no},
       #{pouch_rate},
       (SELECT NVL(MAX(reply_cnt)+1,1) FROM pouch_reply WHERE member_no = #{member_no})
     )
   </insert>
   
   <update id="pouchReplyCntIncrement" parameterType="int">
     UPDATE pouch
     SET review_cnt = review_cnt + 1
     WHERE pouch_no = #{pouch_no}
   </update>
   
   <update id="pouchReplyCntDecrement" parameterType="int">
     UPDATE pouch
     SET review_cnt = review_cnt - 1
     WHERE pouch_no = #{pouch_no}
   </update>
   
   <update id="pouchReplyUpdate" parameterType="Pouch_ReplyVO">
     UPDATE pouch_reply SET
     content = #{content}
     WHERE member_no = #{member_no} AND pouch_reply_no = #{pouch_reply_no}
   </update>
   
   <delete id="pouchReplyDelete" parameterType="Pouch_ReplyVO">
    DELETE FROM pouch_reply
    WHERE member_no = #{member_no} AND pouch_reply_no = #{pouch_reply_no}
   </delete>
	

</mapper>
